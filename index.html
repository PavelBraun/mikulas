<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024, initial-scale=1.0">
    <title>Mikul√°≈°sk√° aplikace</title>
    <link rel="icon" type="image/png" href="images/app-icon.png">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Jemn√° vizu√°ln√≠ zpƒõtn√° vazba pro PINpad tlaƒç√≠tka */
        .pinpad-btn { transition: opacity 80ms ease; }
        .pinpad-btn:hover { opacity: 0.7; }
        .pinpad-btn:active { transform: translateY(1px); }
        /* Tisk: skr√Ωt ovl√°dac√≠ prvky a tlaƒç√≠tka; tisknout pouze dopis, bez pozad√≠ */
        @page { }
        @media print {
            /* Reset v√Ωchoz√≠ho layoutu pro tisk */
            html, body { margin: 0 !important; padding: 0 !important; background: none !important; }

            /* Skryjeme v≈°e, co nen√≠ dopis */
            .no-print, .btn-large, .btn-small, button, .help-btn, .modal, .pinpad-btn, .admin-screen, .screen:not(#letterScreen) { display: none !important; }

            /* Zajist√≠me, ≈æe letterScreen zabere celou str√°nku a obsah bude centrov√°n */
            #letterScreen { display: block !important; }
            #letterScreen .content { display: flex !important; align-items: flex-start !important; height: 100% !important; margin: 0 !important; }

            /* Pergamen bude form√°tov√°n jako √∫ƒçtenka: ≈°√≠≈ôka 80mm, men≈°√≠ padding a fonty; vycentrov√°no horizont√°lnƒõ, naho≈ôe vertik√°lnƒõ */
            @page {}
            #letterScreen .content { display: flex !important; align-items: flex-start !important; }
            .parchment { box-shadow: none !important; background: #fff !important; width: 100% !important; margin: 0 auto !important; font-size: 11px !important; line-height: 1.2 !important; }

            /* Pokud chce≈° jinou ≈°√≠≈ôku √∫ƒçtenky, uprav parametry width/padding v√Ω≈°e */

            /* Text dopisu ƒçernƒõ a ƒçitelnƒõ */
            #letterText { color: #000 !important; }
        }
    </style>
</head>
<body>

    <!-- Overlay PINpad -->
    <div id="pinpadOverlay" style="position: fixed; left: 0; top: 0; width: 1024px; height: 1280px; background: rgba(0,0,0,0); z-index: 2000; align-items: center; justify-content: center;">
    <div style="position: absolute; left: 200px; top: 910px;">
            <h2 style="text-align:center; margin-bottom:12px;">&nbsp;</h2>
            <div id="pinpadDigits" style="display:flex; justify-content:center; gap:8px; margin-top:16px;"></div>
            <div style="display:grid; grid-template-columns:repeat(3,100px); gap:12px; justify-content:center;">
                <button class="pinpad-btn" data-digit="1">1</button>
                <button class="pinpad-btn" data-digit="2">2</button>
                <button class="pinpad-btn" data-digit="3">3</button>
                <button class="pinpad-btn" data-digit="4">4</button>
                <button class="pinpad-btn" data-digit="5">5</button>
                <button class="pinpad-btn" data-digit="6">6</button>
                <button class="pinpad-btn" data-digit="7">7</button>
                <button class="pinpad-btn" data-digit="8">8</button>
                <button class="pinpad-btn" data-digit="9">9</button>
                <button class="pinpad-btn" data-action="clear">C</button>
                <button class="pinpad-btn" data-digit="0">0</button>
                <button class="pinpad-btn" data-action="ok">OK</button>
            </div>
        </div>
    </div>
    <!-- √övodn√≠ obrazovka -->
    <div id="welcomeScreen" class="screen active" style="background-image: url('images/bg-welcome.png')">
        <div class="content">
            <h1>V√≠tej!</h1>
            <div style="display:flex; gap:20px; align-items:center; justify-content:center;">
                <button onclick="app.goToPin()" class="btn-large">START</button>
                <button onclick="app.startImagePinDirect()" class="btn-large image-icon-btn" title="Obr√°zkov√© PIN" style="padding:12px; width:84px; height:84px; display:flex; align-items:center; justify-content:center;"><img src="images/i-kachnicka.png" style="width:64px;height:64px;object-fit:contain;"></button>
            </div>
        </div>
    </div>

    <!-- PIN obrazovka -->
    <div id="pinScreen" class="screen" style="background-image: url('images/bg-pin.png')">
        <button class="secret-joke-btn" onclick="app.triggerJoke()"></button>
        <div class="content">
            <div class="pin-inputs">
                <input type="tel" maxlength="1" class="pin-digit" data-index="0" pattern="[0-9]*" inputmode="numeric" onclick="app.secretCode()">
                <input type="tel" maxlength="1" class="pin-digit" data-index="1" pattern="[0-9]*" inputmode="numeric" onclick="app.secretCode()">
                <input type="tel" maxlength="1" class="pin-digit" data-index="2" pattern="[0-9]*" inputmode="numeric" onclick="app.secretCode()">
                <input type="tel" maxlength="1" class="pin-digit" data-index="3" pattern="[0-9]*" inputmode="numeric" onclick="app.secretCode()">
            </div>
        </div>
    </div>

    <!-- PIN obrazovka obrazkova pro male deti -->
    <div id="pinImageScreen" class="screen" style="background-image: url('images/bg-pin.png');">
        <div class="content">
            <div style="margin-bottom:8px;">
                <div id="imageLastPressed" style="font-size:48px; height:56px; line-height:56px; color:white; text-shadow:1px 1px #000;">&nbsp;</div>
            </div>
            <div class="pin-inputs" id="imagePinDots" style="margin-bottom:16px;">
                <span class="pin-digit">&nbsp;</span>
                <span class="pin-digit">&nbsp;</span>
                <span class="pin-digit">&nbsp;</span>
                <span class="pin-digit">&nbsp;</span>
            </div>
            <div id="imagePinGrid" style="display:grid; grid-template-columns:repeat(3,160px); gap:10px; justify-content:center;">
                <!-- Buttons rendered by JS with images mapping to digits 1-9 -->
            </div>
            <div style="display:flex; gap:12px; justify-content:center; margin-top:12px;">
                <button class="btn-large continue" id="imagePinCancel">Zru≈°it</button>
            </div>
        </div>
    </div>



    <!-- Dopis na pergamenu -->
    <div id="letterScreen" class="screen" style="background-image: url('images/bg-letter.png')">
        <button id="printButton" class="btn-small no-print" onclick="app.showPrintPreview()" style="position:absolute; right:20px; top:20px; z-index:2000; display:none;">Tisk</button>
        <button class="secret-regenerate-btn" onclick="app.regenerateContent()"></button>
        <div class="content">
            <div class="parchment">
                <div id="letterText" class="letter-text"></div>
            </div>
                <button id="endLetterButton" onclick="app.finishLetterAndPrint()" class="btn-large continue">Dokonƒçit</button>
        </div>
    </div>

    <!-- Wheel / Wait screen with progress bar (restored) -->
    <div id="wheelScreen" class="screen" style="background-image: url('images/bg-kolo.png')">
        <div class="content">
                <div class="loading-container">
                    <div class="loading-text">Hled√°m ve sv√Ωch pozn√°mk√°ch...</div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                </div>
        </div>
    </div>

    <!-- (waitScreen addition cancelled) -->

    <!-- Print preview lightbox -->
    <div id="printPreview" class="modal no-print" style="display:none; align-items:center; justify-content:center;">
        <div class="print-preview-content" style="position:relative; width:820px; max-width:95%;">
            <div class="print-preview-bg" style="background-size: cover; padding: 40px;">
                <div id="printPreviewLetter" style="background: rgba(255,255,255,0.0);">
                </div>
            </div>
            <div style="position:absolute; right:12px; top:12px; display:flex; gap:8px;">
                <button class="btn-small" onclick="app.printPreview();" style="display:none;">Tisk</button>
                <button class="btn-small" onclick="app.closePrintPreview();">Zav≈ô√≠t</button>
                <button class="btn-small" onclick="app.savePreviewPdf();" style="display:none;">Ulo≈æit PDF</button>
            </div>
        </div>
    </div>

    <!-- Rozlouƒçen√≠ -->
    <div id="goodbyeScreen" class="screen" style="background-image: url('images/bg-goodbye.png')">
        <div class="content">
            <h1>Dƒõkujeme,<br>a tƒõ≈°√≠me se na dal≈°√≠ setk√°n√≠!</h1>
            <button onclick="app.restart()" class="btn-large">Zaƒç√≠t znovu</button>
        </div>
    </div>

    <!-- Admin panel -->
    <div id="adminScreen" class="screen admin-screen">
        <button class="help-btn" onclick="app.showHelp()" title="N√°povƒõda">?</button>
        <button class="close-admin-btn" onclick="app.closeAdmin()" title="Zav≈ô√≠t administraci">‚úï</button>
        <div class="content">
            <h1>Administrace</h1>
            <div id="dropZone" class="file-drop-zone"><p>P≈ôet√°hnƒõte sem z√°lohu (.json nebo .csv)</p><input type="file" id="dropZoneFileInput" style="display:none" accept=".json,.csv"></div>
            <button type="button" onclick="app.exportBackup()" class="btn-large continue">üíæ Z√°lohovat</button>
            <button type="button" id="resetDataBtn" class="btn-large continue btn-danger">üóëÔ∏è Zaƒç√≠t znovu</button>
            <button type="button" id="soundToggle" class="btn-large continue">Zvuk ON</button>
            <button type="button" id="autoPrintToggle" class="btn-large continue">AutoTisk ON</button>
            <button type="button" id="hotfolderToggle" class="btn-large continue">Pou≈æ√≠t hotfolder OFF</button>
                
            <div class="admin-tabs">
                <button class="admin-tab-btn" id="tab-names" onclick="app.switchAdminTab('names')">Jm√©na</button>
                <button class="admin-tab-btn" id="tab-jokes" onclick="app.switchAdminTab('jokes')">Vtipy</button>
                <button class="admin-tab-btn" id="tab-phrases" onclick="app.switchAdminTab('phrases')">FRAZE</button>
            </div>
            <div id="adminTabContent">
                <!-- Dynamicky generov√°no JS -->
            </div>
            <div class="admin-controls" style="margin-top:12px; display:flex; gap:8px; align-items:center;">
                <button type="button" id="simulatePrintToggle" class="btn-large continue">Simulate Print OFF</button>
                <button type="button" id="printerDebugBtn" class="btn-small" onclick="devPrintDebug()">Debug Printers</button>
            </div>
            <button onclick="app.closeAdmin()" class="btn-large continue">Zav≈ô√≠t administraci</button>
        </div>
    </div>

    <!-- Modal pro editaci jm√©na/vtipu/fraze -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2 id="editModalTitle">Upravit</h2>
            <label id="editModalLabel">Pozn√°mka:</label>
            <textarea id="modalEditText"></textarea>
            <div class="modal-buttons">
                <button class="btn-edit" onclick="app.saveEditModal()">üíæ Ulo≈æit</button>
                <button class="btn-edit" onclick="app.closeModal()">‚ùå Zru≈°it</button>
            </div>
        </div>
    </div>

    <!-- Modal pro import -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <h2 id="importModalTitle">Importovat CSV</h2>
            <input type="file" id="importFileInput" accept=".csv">
            <div class="modal-buttons">
                <button class="btn-edit" onclick="app.importCSVModal()">üìÇ Importovat</button>
                <button class="btn-edit" onclick="app.closeImportModal()">‚ùå Zru≈°it</button>
            </div>
            <div id="importTemplateLink"></div>
        </div>
    </div>

    <!-- Modal s n√°povƒõdou -->
    <div id="helpModal" class="modal">
        <div class="modal-content help-modal">
            <button class="modal-close-btn" onclick="app.closeHelp()" title="Zav≈ô√≠t">‚úï</button>
            <h2>üìñ Dokumentace Mikul√°≈°sk√© aplikace</h2>
            
            <div class="help-section">
                <p>Pro v√≠ce≈ô√°dkov√Ω text pou≈æijte uvozovky. Excel: ulo≈æte jako CSV UTF-8.</p>
                                    Mikul√°≈° a spol.</pre>
            </div>
                <div class="help-section">
                    <h3>üéØ Z√°kladn√≠ pou≈æit√≠</h3>
                    <p>Aplikace slou≈æ√≠ k zobrazen√≠ personalizovan√Ωch dopis≈Ø od Mikul√°≈°e. Ka≈æd√© d√≠tƒõ m√° sv≈Øj unik√°tn√≠ PIN k√≥d. K dispozici je administrace pro spr√°vu dƒõt√≠, vtip≈Ø a motivaƒçn√≠ch fr√°z√≠.</p>
                </div>

                <div class="help-section">
                    <h3>üî¢ Speci√°ln√≠ PIN k√≥dy</h3>
                    <ul>
                        <li><strong>9989</strong> - Vstup do administrace</li>
                        <li><strong>7897</strong> - Fortune cookie (n√°hodn√Ω motivaƒçn√≠ cit√°t)</li>
                        <li><strong>1231</strong> - ≈†tƒõst√≠ƒçko s motivaƒçn√≠m cit√°tem</li>
                        <li><strong>4564</strong> - Vtipn√Ω re≈æim s n√°hodn√Ωm vtipem</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üéÆ Ovl√°d√°n√≠</h3>
                    <ul>
                        <li><strong>Enter</strong> - Potvrzen√≠ na obrazovk√°ch s jedn√≠m tlaƒç√≠tkem</li>
                        <li><strong>Mezern√≠k</strong> - Tajn√Ω k√≥d (PIN 7897) na PIN obrazovce</li>
                        <li><strong>Kliknut√≠ na PIN pole</strong> - Tak√© spust√≠ tajn√Ω k√≥d (7897)</li>
                        <li><strong>Drag & Drop</strong> - P≈ôet√°hnƒõte z√°lohu (.json/.csv) na dropzonu v administraci</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üë• Administrace</h3>
                    <ul>
                        <li>Taby pro spr√°vu: Jm√©na, Vtipy, FRAZE</li>
                        <li>P≈ôid√°n√≠, √∫prava, maz√°n√≠ polo≈æek</li>
                        <li>Export/import CSV pro ka≈ædou sekci</li>
                        <li>Export z√°lohy aplikace (JSON)</li>
                        <li>Potvrzen√≠ maz√°n√≠: kliknƒõte dvakr√°t na tlaƒç√≠tko üóëÔ∏è</li>
                        <li>Reset dat: tlaƒç√≠tko vymazat data a zaƒç√≠t znovu (potvrzen√≠)</li>
                        <li>N√°povƒõda: tlaƒç√≠tko ? vpravo naho≈ôe</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üíæ Import a Export</h3>
                    <p><strong>Export jmen:</strong> CSV soubor s PIN, Jm√©no, Text dopisu.</p>
                    <p><strong>Export vtip≈Ø/fr√°z√≠:</strong> CSV soubor s pozn√°mkami.</p>
                    <p><strong>Export z√°lohy:</strong> JSON soubor s celou datab√°z√≠.</p>
                    <p><strong>Import:</strong> Podporuje form√°ty .json a .csv. P≈ôet√°hnƒõte soubor na dropzonu nebo pou≈æijte tlaƒç√≠tko Importovat.</p>
                    <p><strong>CSV form√°t:</strong></p>
                    <pre>PIN,Jmeno,Text dopisu
                    <p>Pro v√≠ce≈ô√°dkov√Ω text pou≈æijte uvozovky. Excel: ulo≈æte jako CSV UTF-8.</p>
                </div>

                <div class="help-section">
                    <h3>‚úâÔ∏è Form√°t dopisu</h3>
                    <p>K textu dopisu se automaticky p≈ôid√°v√° patiƒçka: U≈æij si svou odmƒõnu!</p>
                    
                </div>

                <div class="help-section">
                    <h3>üç™ Fortune Cookie (PIN 7897)</h3>
                    <p>Speci√°ln√≠ PIN generuje n√°hodn√© jm√©no a motivaƒçn√≠ cit√°t. D√≠tƒõ nen√≠ ulo≈æeno do datab√°ze.</p>
                </div>

                <div class="help-section">
                    <h3>üòÑ Vtipn√Ω re≈æim (PIN 4564)</h3>
                    <p>Speci√°ln√≠ PIN zobrazuje n√°hodn√Ω vtip. Perfektn√≠ pro pobaven√≠!</p>
                </div>

                <div class="help-section">
                    <h3>‚öôÔ∏è Technick√© informace</h3>
                    <ul>
                        <li>Data jsou ulo≈æena v lok√°ln√≠m √∫lo≈æi≈°ti prohl√≠≈æeƒçe</li>
                        <li>Rozli≈°en√≠: 1024√ó1280 px (kiosek re≈æim)</li>
                        <li>Doporuƒçen√Ω prohl√≠≈æeƒç: Chrome, Edge</li>
                    </ul>
                </div>
    </div>
</body>

    <script src="app.js"></script>
</html>

<!-- Toast container for small notifications -->
<div id="toast" style="position:fixed; left:50%; transform:translateX(-50%); bottom:24px; background:rgba(0,0,0,0.8); color:#fff; padding:8px 14px; border-radius:6px; display:none; z-index:3000; font-size:14px;"></div>
